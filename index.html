
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ğŸ† 2026å…ƒæ—¦å¿«ä¹ ğŸ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: none;
            touch-action: manipulation;
        }
        
        body, html {
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            position: fixed;
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
        }
        
        canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .title {
            position: fixed;
            top: env(safe-area-inset-top, 20px);
            left: 0;
            width: 100%;
            text-align: center;
            color: #fff;
            font-size: clamp(1.8em, 6vw, 2.5em);
            text-shadow: 0 0 10px #ff4081,
                         0 0 20px #ff4081,
                         0 0 30px #ff4081;
            z-index: 100;
            opacity: 0.8;
            padding: 10px;
            pointer-events: none;
        }
        
        .controls {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 0) + 20px);
            left: 0;
            width: 100%;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 0 10px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            color: white;
            padding: 12px 20px;
            font-size: clamp(0.9em, 3vw, 1em);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .control-btn:active {
            transform: scale(0.95);
            background: rgba(255, 64, 129, 0.3);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: clamp(1em, 4vw, 1.2em);
            z-index: 100;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            padding: 20px 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeOut 3s ease-out forwards;
            animation-delay: 3s;
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }
        
        .stats {
            position: fixed;
            top: calc(env(safe-area-inset-top, 20px) + 80px);
            right: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9em;
            z-index: 100;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 10px;
            pointer-events: none;
        }
        
        .power-saver {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 0) + 80px);
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8em;
            z-index: 100;
        }
        
        .tap-hint {
            position: fixed;
            bottom: 120px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1em;
            z-index: 100;
            pointer-events: none;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .controls {
                bottom: calc(env(safe-area-inset-bottom, 0) + 10px);
            }
            
            .control-btn {
                padding: 10px 15px;
                min-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 1.8em;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 0.9em;
                min-width: 70px;
            }
            
            .stats {
                top: calc(env(safe-area-inset-top, 20px) + 60px);
                font-size: 0.8em;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼é€‚é… */
        @media (orientation: landscape) {
            .title {
                font-size: 2em;
            }
            
            .controls {
                bottom: 10px;
            }
            
            .instructions {
                font-size: 1em;
                max-width: 80%;
            }
        }
    </style>
</head>
<body>
    <div class="title">ğŸ† 2026å…ƒæ—¦å¿«ä¹ğŸ†</div>
    <div class="instructions">ç‚¹å‡»å±å¹•å‘å°„çƒŸèŠ±ï¼</div>
    <div class="stats">çƒŸèŠ±: <span id="firework-count">0</span> | ç²’å­: <span id="particle-count">0</span></div>
    <div class="tap-hint">ğŸ’¡ é•¿æŒ‰å±å¹•è¿ç»­å‘å°„</div>
    <div class="power-saver">âš¡ è‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½</div>
    <canvas id="fireworks"></canvas>
    
    <div class="controls">
        <button class="control-btn" onclick="createBurst()">ğŸ’¥ çˆ†å‘</button>
        <button class="control-btn" onclick="toggleFireworks()">â¸ï¸ æš‚åœ</button>
        <button class="control-btn" onclick="changeTheme()">ğŸ¨ æ¢è‰²</button>
        <button class="control-btn" onclick="clearAll()">ğŸ§¹ æ¸…é™¤</button>
    </div>

<script>
// æ€§èƒ½ä¼˜åŒ–
let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
let isLowPowerMode = false;
let isAnimating = true;
let frameCount = 0;
let lastUpdate = 0;
const FPS = 60;
const frameInterval = 1000 / FPS;

// åˆå§‹åŒ–ç”»å¸ƒ
const canvas = document.getElementById('fireworks');
const ctx = canvas.getContext('2d');

// è®¾å¤‡åƒç´ æ¯”é€‚é…
let dpr = window.devicePixelRatio || 1;

function resizeCanvas() {
    const width = window.innerWidth;
    const height = window.innerHeight;
    
    // è®¾ç½®å®é™…åƒç´ å°ºå¯¸
    canvas.width = width * dpr;
    canvas.height = height * dpr;
    
    // è®¾ç½®æ˜¾ç¤ºå°ºå¯¸
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    
    // ç¼©æ”¾ä¸Šä¸‹æ–‡
    ctx.scale(dpr, dpr);
}

resizeCanvas();

// é˜²æŠ–çš„é‡ç½®å‡½æ•°
let resizeTimeout;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(resizeCanvas, 100);
});

// æ£€æµ‹ä½ç”µé‡æ¨¡å¼
if (navigator.getBattery) {
    navigator.getBattery().then(battery => {
        if (battery.level < 0.2 || !battery.charging) {
            isLowPowerMode = true;
            optimizeForLowPower();
        }
    });
}

// ç²’å­ç±»ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
class Particle {
    constructor(x, y, color, isSpark = false) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.radius = isSpark ? 
            Math.random() * 1.2 + 0.3 : 
            Math.random() * 1.5 + 0.5;
        
        const angle = Math.random() * Math.PI * 2;
        const speed = isSpark ? 
            Math.random() * 3 + 1.5 : 
            Math.random() * 4;
        
        this.velocity = {
            x: Math.cos(angle) * speed,
            y: Math.sin(angle) * speed
        };
        
        this.alpha = 1;
        this.gravity = 0.03;
        this.friction = 0.96;
        this.decay = Math.random() * 0.01 + 0.005;
        this.isSpark = isSpark;
    }

    draw() {
        if (this.alpha <= 0) return;
        
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        
        if (this.isSpark) {
            ctx.fillStyle = this.color;
        } else {
            const gradient = ctx.createRadialGradient(
                this.x, this.y, 0,
                this.x, this.y, this.radius * 2
            );
            gradient.addColorStop(0, this.color);
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient;
        }
        
        ctx.fill();
        ctx.restore();
    }

    update() {
        this.velocity.x *= this.friction;
        this.velocity.y *= this.friction;
        this.velocity.y += this.gravity;
        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.alpha -= this.decay;
        
        return this.alpha > 0;
    }
}

// çƒŸèŠ±ç±»ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
class Firework {
    constructor(x, y, targetX, targetY, color) {
        this.x = x;
        this.y = y;
        this.targetX = targetX;
        this.targetY = targetY;
        this.color = color;
        this.speed = 6;
        this.trail = [];
        this.maxTrail = 4; // å‡å°‘è½¨è¿¹ç‚¹ä»¥èŠ‚çœæ€§èƒ½
        
        const angle = Math.atan2(targetY - y, targetX - x);
        this.velocity = {
            x: Math.cos(angle) * this.speed,
            y: Math.sin(angle) * this.speed
        };
        
        this.exploded = false;
    }

    draw() {
        // ç»˜åˆ¶è½¨è¿¹
        ctx.save();
        for (let i = 0; i < this.trail.length; i++) {
            const point = this.trail[i];
            const alpha = i / this.trail.length;
            
            ctx.globalAlpha = alpha * 0.6;
            ctx.beginPath();
            ctx.arc(point.x, point.y, 1, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
        ctx.restore();

        // ç»˜åˆ¶çƒŸèŠ±å¤´
        ctx.save();
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.restore();
    }

    update() {
        // æ·»åŠ è½¨è¿¹ç‚¹
        this.trail.push({x: this.x, y: this.y});
        if (this.trail.length > this.maxTrail) {
            this.trail.shift();
        }

        this.x += this.velocity.x;
        this.y += this.velocity.y;
        this.draw();

        const dx = this.targetX - this.x;
        const dy = this.targetY - this.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        return distance > 5;
    }
}

// å…¨å±€å˜é‡
let fireworks = [];
let particles = [];
let lastFireworkTime = 0;
let autoFireworkInterval = 1500;
let isAutoFiring = true;
let currentTheme = 0;
let touchStartTime = 0;
let isTouching = false;
let touchInterval = null;

// é¢œè‰²ä¸»é¢˜
const colorThemes = [
    // ä¸»é¢˜1: ç»å…¸
    ['#FF4081', '#3D5AFE', '#00BCD4', '#4CAF50', '#FFEB3B'],
    // ä¸»é¢˜2: éœ“è™¹
    ['#FF00FF', '#00FFFF', '#FFFF00', '#FF0000', '#00FF00'],
    // ä¸»é¢˜3: æŸ”å’Œ
    ['#FFB6C1', '#87CEEB', '#98FB98', '#DDA0DD', '#F0E68C'],
    // ä¸»é¢˜4: å•è‰²
    ['#FF4081', '#FF4081', '#FF4081', '#FF4081', '#FF4081']
];

function getRandomColor() {
    return colorThemes[currentTheme][Math.floor(Math.random() * colorThemes[currentTheme].length)];
}

function createFirework(x = null, y = null) {
    if (!isAnimating) return;
    
    const startX = x !== null ? x : Math.random() * canvas.width / dpr;
    const startY = y !== null ? y : canvas.height / dpr;
    
    const targetX = x !== null ? 
        startX + (Math.random() - 0.5) * 150 : 
        Math.random() * canvas.width / dpr;
    
    const targetY = y !== null ? 
        Math.random() * (canvas.height / dpr) * 0.6 : 
        Math.random() * (canvas.height / dpr) * 0.5;
    
    fireworks.push(new Firework(startX, startY, targetX, targetY, getRandomColor()));
    updateStats();
}

function createExplosion(x, y, color) {
    const particleCount = isLowPowerMode ? 80 : 120;
    
    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle(x, y, color));
    }
    
    // æ·»åŠ ç«èŠ±
    for (let i = 0; i < 20; i++) {
        particles.push(new Particle(x, y, '#FFFFFF', true));
    }
    
    updateStats();
}

function createBurst() {
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            createFirework();
        }, i * 100);
    }
}

function toggleFireworks() {
    isAutoFiring = !isAutoFiring;
    const btn = document.querySelector('.control-btn:nth-child(2)');
    btn.textContent = isAutoFiring ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ ç»§ç»­';
}

function changeTheme() {
    currentTheme = (currentTheme + 1) % colorThemes.length;
    document.querySelector('.control-btn:nth-child(3)').textContent = 
        `ğŸ¨ ä¸»é¢˜${currentTheme + 1}`;
}

function clearAll() {
    fireworks = [];
    particles = [];
    updateStats();
}

function optimizeForLowPower() {
    autoFireworkInterval = 3000;
    document.querySelector('.power-saver').textContent = 'âš¡ çœç”µæ¨¡å¼å·²å¯ç”¨';
}

function updateStats() {
    document.getElementById('firework-count').textContent = fireworks.length;
    document.getElementById('particle-count').textContent = particles.length;
}

// åŠ¨ç”»å¾ªç¯
function animate(timestamp) {
    if (!lastUpdate) lastUpdate = timestamp;
    const elapsed = timestamp - lastUpdate;
    
    if (elapsed > frameInterval) {
        // æ¸…é™¤ç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // è‡ªåŠ¨å‘å°„çƒŸèŠ±
        if (isAutoFiring && timestamp - lastFireworkTime > autoFireworkInterval) {
            createFirework();
            lastFireworkTime = timestamp;
        }
        
        // æ›´æ–°çƒŸèŠ±
        for (let i = fireworks.length - 1; i >= 0; i--) {
            if (isAnimating && fireworks[i].update()) {
                continue;
            }
            
            // çˆ†ç‚¸
            createExplosion(fireworks[i].x, fireworks[i].y, fireworks[i].color);
            fireworks.splice(i, 1);
        }
        
        // æ›´æ–°ç²’å­
        for (let i = particles.length - 1; i >= 0; i--) {
            if (isAnimating && particles[i].update()) {
                continue;
            }
            particles.splice(i, 1);
        }
        
        lastUpdate = timestamp - (elapsed % frameInterval);
        updateStats();
    }
    
    requestAnimationFrame(animate);
}

// è§¦æ‘¸äº‹ä»¶å¤„ç†
function handleTouchStart(e) {
    e.preventDefault();
    isTouching = true;
    touchStartTime = Date.now();
    
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / dpr / rect.width;
    const scaleY = canvas.height / dpr / rect.height;
    
    const x = (touch.clientX - rect.left) * scaleX;
    const y = (touch.clientY - rect.top) * scaleY;
    
    createFirework(x, y);
    
    // é•¿æŒ‰è¿ç»­å‘å°„
    touchInterval = setInterval(() => {
        if (isTouching) {
            createFirework(x, y);
        }
    }, 200);
}

function handleTouchMove(e) {
    if (isTouching) {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / dpr / rect.width;
        const scaleY = canvas.height / dpr / rect.height;
        
        const x = (touch.clientX - rect.left) * scaleX;
        const y = (touch.clientY - rect.top) * scaleY;
        
        if (Date.now() - touchStartTime > 300) { // é•¿æŒ‰300msåè·Ÿéšç§»åŠ¨
            createFirework(x, y);
        }
    }
}

function handleTouchEnd() {
    isTouching = false;
    if (touchInterval) {
        clearInterval(touchInterval);
        touchInterval = null;
    }
}

// ç‚¹å‡»äº‹ä»¶å¤„ç†
canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / dpr / rect.width;
    const scaleY = canvas.height / dpr / rect.height;
    
    const x = (e.clientX - rect.left) * scaleX;
    const y = (e.clientY - rect.top) * scaleY;
    
    createFirework(x, y);
});

// è§¦æ‘¸äº‹ä»¶ç›‘å¬
canvas.addEventListener('touchstart', handleTouchStart, {passive: false});
canvas.addEventListener('touchmove', handleTouchMove, {passive: false});
canvas.addEventListener('touchend', handleTouchEnd);
canvas.addEventListener('touchcancel', handleTouchEnd);

// é˜²æ­¢é¡µé¢æ»šåŠ¨
document.addEventListener('touchmove', (e) => {
    if (e.target === canvas || e.target.closest('.controls')) {
        e.preventDefault();
    }
}, {passive: false});

// åˆå§‹åŒ–ä¸€äº›çƒŸèŠ±
for (let i = 0; i < 3; i++) {
    setTimeout(() => createFirework(), i * 300);
}

// é¡µé¢å¯è§æ€§API
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        isAnimating = false;
    } else {
        isAnimating = true;
        lastUpdate = 0;
    }
});

// å¼€å§‹åŠ¨ç”»
animate();

// æ€§èƒ½ç›‘æ§
if ('performance' in window) {
    setInterval(() => {
        const mem = performance.memory;
        if (mem && mem.usedJSHeapSize > 100 * 1024 * 1024) { // è¶…è¿‡100MB
            clearAll();
            optimizeForLowPower();
        }
    }, 10000);
}
</script>
</body>
</html>
